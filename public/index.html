<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#4a90d9">
  <meta name="description" content="谁是卧底 - 多人社交推理游戏">
  <title>谁是卧底</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Roboto+Mono:wght@400;500;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div id="app">
    <!-- Page Loader -->
    <div id="page-loader" class="hidden">
      <div class="loader-spinner"></div>
      <p class="loader-text">加载中...</p>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Confirm Dialog -->
    <div id="confirm-dialog" class="dialog-overlay hidden">
      <div class="dialog-box">
        <div id="confirm-icon" class="dialog-icon warning">⚠</div>
        <h3 id="confirm-title" class="dialog-title">确认操作</h3>
        <p id="confirm-message"></p>
        <div class="dialog-buttons">
          <button id="confirm-cancel" class="btn btn-secondary">取消</button>
          <button id="confirm-ok" class="btn btn-primary">确认</button>
        </div>
      </div>
    </div>

    <!-- Bot Config Dialog -->
    <div id="bot-config-dialog" class="dialog-overlay hidden">
      <div class="dialog-box bot-config-box">
        <h3 class="dialog-title">添加 AI 玩家</h3>
        <form id="form-add-bot" class="form-cyber">

          <div class="form-group-cyber">
            <label>选择模型</label>
            <div class="select-wrapper">
              <select id="bot-provider">
                <!-- Options loaded from /api/providers -->
                <option value="">点击加载...</option>
              </select>
              <div class="select-arrow">▼</div>
            </div>
          </div>

          <div class="form-group-cyber">
            <label>AI 昵称</label>
            <div class="input-wrapper">
              <input type="text" id="bot-name" placeholder="随机昵称">
              <div class="input-line"></div>
            </div>
          </div>

          <div class="form-group-cyber">
            <label>角色人格</label>
            <div class="select-wrapper">
              <select id="bot-persona">
                <option value="default">标准 AI（无人格）</option>
                <option value="luxun">鲁迅（犀利讽刺）</option>
                <option value="poet">诗人（浪漫诗意）</option>
                <option value="detective">侦探（逻辑推理）</option>
                <option value="child">小朋友（天真可爱）</option>
                <option value="philosopher">哲学家（深沉抽象）</option>
              </select>
              <div class="select-arrow">▼</div>
            </div>
          </div>

          <div class="dialog-buttons">
            <button type="button" id="bot-cancel" class="btn btn-secondary">取消</button>
            <button type="submit" class="btn btn-primary">添加</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Page: Home -->
    <div id="page-home" class="page">
      <div class="page-container-flex centered-content">
        <div class="hero-section">
          <header class="app-header-cyber">
            <h1 class="app-title-glitch" data-text="谁是卧底">谁是卧底</h1>
            <p class="app-subtitle-cyber">Who is the Spy</p>
          </header>

          <div class="home-actions-cyber">
            <button id="btn-create-room" class="btn-cyber-primary btn-hero">
              <span class="btn-text">创建房间</span>
              <div class="btn-glow"></div>
            </button>
            <button id="btn-join-room" class="btn-cyber-secondary btn-hero">
              <span class="btn-text">加入房间</span>
            </button>
          </div>
        </div>

        <footer class="home-footer-cyber">
          <a href="#rules" class="link-cyber">
            <span class="icon">⚠</span> 游戏规则
          </a>
        </footer>
      </div>
    </div>

    <!-- Page: Create Room -->
    <div id="page-create" class="page hidden">
      <div class="page-container-flex">
        <header class="nav-bar">
          <button class="btn-nav-back" data-back="home">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <h2 class="nav-title">创建房间</h2>
        </header>

        <div class="content-scroll">
          <div class="cyber-card form-card">
            <form id="form-create" class="form-cyber">
              <div class="form-group-cyber">
                <label for="create-name">你的昵称</label>
                <div class="input-wrapper">
                  <input type="text" id="create-name" placeholder="2-10个字符" minlength="2" maxlength="10" required>
                  <div class="input-line"></div>
                </div>
              </div>

              <div class="cyber-hint">
                <span class="icon">ℹ</span> 房间密码将在创建后自动生成
              </div>

              <div style="margin-top: 32px;">
                <button type="submit" class="btn-cyber-primary btn-block">
                  <span class="btn-text">创建房间</span>
                  <div class="btn-glow"></div>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Page: Join Room -->
    <div id="page-join" class="page hidden">
      <div class="page-container-flex">
        <header class="nav-bar">
          <button class="btn-nav-back" data-back="home">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <h2 class="nav-title">加入房间</h2>
        </header>

        <div class="content-scroll">
          <div class="cyber-card form-card">
            <form id="form-join" class="form-cyber">
              <div class="form-group-cyber">
                <label for="join-code">房间号</label>
                <div class="input-wrapper">
                  <input type="text" id="join-code" placeholder="6位数字" pattern="[0-9]{6}" maxlength="6" required
                    inputmode="numeric">
                  <div class="input-line"></div>
                </div>
              </div>

              <div class="form-group-cyber">
                <label for="join-password">房间密码</label>
                <div class="input-wrapper">
                  <input type="text" id="join-password" name="room-password-join" placeholder="4-8个字符" minlength="4"
                    maxlength="8" required autocomplete="off" data-lpignore="true" data-form-type="other">
                  <div class="input-line"></div>
                </div>
              </div>

              <div class="form-group-cyber">
                <label for="join-name">你的昵称</label>
                <div class="input-wrapper">
                  <input type="text" id="join-name" placeholder="2-10个字符" minlength="2" maxlength="10" required>
                  <div class="input-line"></div>
                </div>
              </div>

              <div style="margin-top: 32px;">
                <button type="submit" class="btn-cyber-primary btn-block">
                  <span class="btn-text">加入房间</span>
                  <div class="btn-glow"></div>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Page: Waiting Room -->
    <div id="page-waiting" class="page hidden">
      <div class="page-container-flex">
        <header class="nav-bar">
          <button class="btn-nav-back" data-back="home">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <h2 class="nav-title">等待中</h2>
        </header>

        <div class="content-scroll">
          <!-- Room Info Card -->
          <div class="cyber-card room-hud">
            <!-- Tech decorations -->
            <div class="hud-corner top-left"></div>
            <div class="hud-corner top-right"></div>
            <div class="hud-corner bottom-right"></div>
            <div class="hud-lines"></div>

            <div class="hud-row main-row">
              <span class="hud-label">房间号</span>
              <div class="hud-value-wrapper">
                <span id="waiting-room-code" class="hud-value code-lg">------</span>
                <button id="btn-copy-code" class="btn-icon-copy" title="复制">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                  </svg>
                </button>
              </div>
            </div>

            <div class="hud-row sub-row">
              <div class="tech-connector"></div>
              <span class="hud-label">房间密码</span>
              <div class="hud-value-wrapper">
                <span id="waiting-room-password" class="hud-value pass-md">----</span>
                <button id="btn-copy-password" class="btn-icon-copy" title="复制">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                  </svg>
                </button>
              </div>
            </div>

            <p class="hud-footer">分享房间号和密码给其他玩家</p>
          </div>

          <!-- Player List -->
          <div class="player-section">
            <h3 class="section-title">玩家列表 (<span id="player-count">0</span>人)</h3>
            <ul id="player-list" class="cyber-list">
              <!-- JS Injected items will look like: 
              <li class="player-item">
                 <div class="p-status"></div>
                 <span class="p-name">Data</span>
                 <span class="p-role">房主</span>
              </li> -->
            </ul>
          </div>
        </div>

        <!-- Bottom Controls (Fixed) -->
        <div class="bottom-dock-wrapper">
          <div id="host-controls" class="host-controls hidden">
            <!-- Spy Count Control -->
            <div class="glass-panel control-row">
              <span class="control-label">卧底数量</span>
              <div class="stepper-cyber">
                <button id="spy-decrease" class="btn-step">−</button>
                <div class="step-display-box">
                  <span id="spy-count-display">1</span>
                </div>
                <button id="spy-increase" class="btn-step">+</button>
              </div>
            </div>

            <!-- Bot Control -->
            <div class="glass-panel control-row">
              <span class="control-label">AI 机器人</span>
              <button id="btn-add-bot" class="btn-cyber-secondary btn-sm">添加 +</button>
            </div>

            <!-- Start Button -->
            <button id="btn-start-game" class="btn-cyber-primary btn-block">
              <div class="btn-content">
                <span class="btn-text">开始游戏 (需要2人)</span>
              </div>
              <div class="btn-glow"></div>
            </button>
          </div>

          <div id="guest-waiting" class="guest-waiting">
            <div class="waiting-text-glitch">等待房主开始游戏...</div>
          </div>
        </div>

      </div>
    </div>

    <!-- Page: Game -->
    <div id="page-game" class="page hidden">
      <div class="page-container-flex">
        <!-- Game Header -->
        <header class="nav-bar">
          <div style="flex:1">
            <div class="game-phase-badge" id="game-phase">游戏中</div>
          </div>
          <div class="game-round-badge">
            ROUND <span id="game-round" style="color:var(--neon-green)">1</span>
          </div>
        </header>

        <div class="content-scroll">

          <!-- Word Reveal Phase -->
          <div id="phase-word-reveal" class="game-phase-content hidden">
            <div class="cyber-card word-card">
              <div class="hud-lines"></div>
              <p class="word-label">你的词语是</p>
              <p id="my-word" class="word-display-glitch">???</p>
              <p class="word-hint">请记住你的词语，不要让别人看到</p>
            </div>

            <div class="action-area">
              <!-- Host: Start description phase button -->
              <button id="btn-confirm-word" class="btn-cyber-primary btn-block hidden">
                <span class="btn-text">开始描述阶段</span>
              </button>
              <!-- Non-host: Confirm button -->
              <button id="btn-confirm-word-player" class="btn-cyber-primary btn-block hidden">
                <span class="btn-text">我记住了</span>
              </button>

              <!-- Waiting hint for non-host players -->
              <div id="word-reveal-waiting" class="guest-waiting hidden">
                <div class="waiting-text-glitch">等待房主开始描述阶段...</div>
              </div>
            </div>

            <!-- Player confirmation status (visible to host) -->
            <div id="word-confirm-status" class="player-confirm-status hidden"></div>
          </div>

          <!-- Description Phase -->
          <div id="phase-description" class="game-phase-content hidden">
            <div class="cyber-card status-card">
              <div class="current-turn">
                <p>当前描述：<span id="current-player-name" class="highlight-name">---</span></p>
              </div>
            </div>

            <div class="cyber-card history-card">
              <h4 class="card-title">描述记录</h4>
              <ul id="description-list" class="cyber-list-small"></ul>
            </div>

            <div id="my-turn-input" class="my-turn-input hidden">
              <form id="form-description" class="form-cyber">
                <div class="form-group-cyber">
                  <div class="input-wrapper">
                    <input type="text" id="description-input" placeholder="输入你的描述（5-50字）" minlength="5" maxlength="50">
                    <div class="input-line"></div>
                  </div>
                </div>
                <button type="submit" class="btn-cyber-primary btn-block">
                  <span class="btn-text">提交描述</span>
                </button>
              </form>
            </div>

            <div id="host-game-controls" class="host-game-controls hidden">
              <div class="host-controls-row">
                <button id="btn-next-player" class="btn-cyber-secondary">跳过</button>
                <button id="btn-start-voting" class="btn-cyber-primary">开始投票</button>
              </div>
            </div>
          </div>

          <!-- Voting Phase -->
          <div id="phase-voting" class="game-phase-content hidden">
            <!-- 描述记录区域（投票时可参考） -->
            <div class="cyber-card history-card voting-history-card">
              <h4 class="card-title">描述记录</h4>
              <ul id="voting-description-list" class="cyber-list-small"></ul>
            </div>

            <div class="cyber-header-text">
              <p>请投票选出卧底</p>
              <p class="voting-progress">已投票：<span id="vote-count" class="vote-count-num">0</span>/<span
                  id="alive-count">0</span></p>
            </div>

            <ul id="vote-player-list" class="cyber-list vote-list"></ul>

            <div id="my-vote-status" class="my-vote-status hidden">
              <div class="cyber-hint">你已投票给：<span id="my-vote-target" class="vote-target-name">---</span></div>
            </div>

            <div id="host-voting-controls" class="host-voting-controls">
              <button id="btn-finalize-voting" class="btn-cyber-primary btn-block hidden">
                <span class="btn-text">结束投票</span>
              </button>
            </div>
          </div>


          <!-- Result Phase -->
          <div id="phase-result" class="game-phase-content hidden">
            <div class="cyber-card result-card">
              <h3 class="card-title">投票结果</h3>
              <div id="elimination-result" class="elimination-result"></div>
            </div>
            <div id="host-result-controls" class="host-result-controls" style="margin-top:20px;">
              <button id="btn-continue-game" class="btn-cyber-primary btn-block hidden">
                <span class="btn-text">继续游戏</span>
              </button>
            </div>
          </div>

          <!-- Game Over Phase -->
          <div id="phase-game-over" class="game-phase-content hidden">
            <div class="cyber-card game-over-card">
              <h2 id="winner-announcement" class="winner-title">游戏结束</h2>

              <div class="role-reveal-section">
                <h4 class="card-subtitle">角色揭晓</h4>
                <ul id="role-reveal-list" class="cyber-list-small"></ul>
              </div>

              <div class="word-reveal-section">
                <p>平民词语：<span id="civilian-word" class="word-highlight">---</span></p>
                <p>卧底词语：<span id="spy-word" class="word-highlight">---</span></p>
              </div>
            </div>

            <div id="host-restart-controls" class="host-restart-controls hidden" style="margin-top:20px;">
              <button id="btn-restart-game" class="btn-cyber-primary btn-block">
                <span class="btn-text">再来一局</span>
              </button>
            </div>
          </div>

        </div>

        <!-- Host Restart Button (visible in all game phases) -->
        <div id="host-restart-btn" class="host-restart-floating hidden">
          <button id="btn-restart-anytime" class="btn-cyber-secondary btn-sm">重新开始</button>
        </div>
      </div>
    </div>

    <!-- Page: Rules -->
    <div id="page-rules" class="page hidden">
      <div class="page-container-flex">
        <header class="nav-bar">
          <button class="btn-nav-back" data-back="home">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <h2 class="nav-title">游戏规则</h2>
        </header>

        <div class="content-scroll">
          <div class="cyber-card rules-card">
            <section class="rule-section">
              <h3>游戏简介</h3>
              <p>谁是卧底是一款多人社交推理游戏。游戏中，大部分玩家是"平民"，少数玩家是"卧底"。平民和卧底会分别获得两个相似但不同的词语。</p>
            </section>
            <section class="rule-section">
              <h3>游戏流程</h3>
              <ol>
                <li>房主创建房间，其他玩家加入</li>
                <li>房主设置卧底数量并开始游戏</li>
                <li>每位玩家查看自己的词语</li>
                <li>轮流描述自己的词语（不能直接说出词语）</li>
                <li>描述结束后进行投票</li>
                <li>得票最多的玩家被淘汰并揭示身份</li>
                <li>重复描述和投票，直到游戏结束</li>
              </ol>
            </section>
            <section class="rule-section">
              <h3>胜利条件</h3>
              <ul>
                <li><strong>平民胜利</strong>：所有卧底被淘汰</li>
                <li><strong>卧底胜利</strong>：存活卧底数量 ≥ 存活平民数量</li>
              </ul>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot Configuration Dialog -->
  <div id="bot-config-dialog" class="modal-overlay hidden">
    <div class="modal-content cyber-card">
      <h3 class="modal-title">添加 AI 玩家</h3>
      <form id="form-add-bot" class="form-cyber">
        <div class="form-group-cyber">
          <label for="bot-provider" class="label-cyber">选择模型</label>
          <div class="input-wrapper">
            <select id="bot-provider" class="select-cyber">
              <option value="">加载中...</option>
            </select>
            <div class="input-line"></div>
          </div>
        </div>

        <div class="form-group-cyber">
          <label for="bot-name" class="label-cyber">AI 昵称</label>
          <div class="input-wrapper">
            <input type="text" id="bot-name" placeholder="随机昵称" class="input-cyber">
            <div class="input-line"></div>
          </div>
        </div>

        <div class="form-group-cyber">
          <label for="bot-persona" class="label-cyber">角色人格</label>
          <div class="input-wrapper">
            <select id="bot-persona" class="select-cyber">
              <option value="default">默认 (普通玩家)</option>
              <option value="luxun">鲁迅 (犀利讽刺)</option>
              <option value="poet">古诗人 (文言文)</option>
              <option value="detective">侦探 (逻辑推理)</option>
              <option value="kid">幼儿园小朋友 (天真可爱)</option>
              <option value="philosopher">哲学家 (深度思考)</option>
              <option value="debater">杠精 (喜欢反驳)</option>
            </select>
            <div class="input-line"></div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" id="bot-cancel" class="btn-cyber-secondary">取消</button>
          <button type="submit" class="btn-cyber-primary">添加</button>
        </div>
      </form>
    </div>
  </div>

  <script src="app.js"></script>
</body>

</html>